# üñ•Ô∏è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∞–º–∏ (VPN-—Å–µ—Ä–≤–µ—Ä–∞–º–∏)

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
4. [–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Remnawave](#–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è-—Å-remnawave)
5. [CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏](#crud-–æ–ø–µ—Ä–∞—Ü–∏–∏)
6. [SSH –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#ssh-–∏-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
7. [–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è](#–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
8. [API Reference](#api-reference)
9. [–ü—Ä–∏–º–µ—Ä—ã](#–ø—Ä–∏–º–µ—Ä—ã)
10. [–°–≤—è–∑—å —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏ –∏ –∫–ª—é—á–∞–º–∏](#—Å–≤—è–∑—å-—Å-—Ç–∞—Ä–∏—Ñ–∞–º–∏-–∏-–∫–ª—é—á–∞–º–∏)

---

## üéØ –í–≤–µ–¥–µ–Ω–∏–µ

**–•–æ—Å—Ç** ‚Äî —ç—Ç–æ VPN-—Å–µ—Ä–≤–µ—Ä, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞–Ω–µ–ª—å Remnawave –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN-–∫–ª—é—á–∞–º–∏. –ö–∞–∂–¥—ã–π —Ö–æ—Å—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Remnawave API
- SSH-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- URL –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ VPN-—Å–µ—Ä–≤–µ—Ä–∞–º–∏
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Remnawave API (–º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ Squad UUID)
- ‚úÖ SSH-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (speedtest –∏ —Ä–µ—Å—É—Ä—Å—ã)
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ —Ç–∞—Ä–∏—Ñ–æ–≤ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–µ–π –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     VPN Bot System                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ
‚îÇ  ‚îÇ  –ü–ª–∞–Ω 1  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  –ü–ª–∞–Ω 2  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  –ü–ª–∞–Ω 3  ‚îÇ     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ
‚îÇ       ‚îÇ                 ‚îÇ                  ‚îÇ            ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò            ‚îÇ
‚îÇ                         ‚îÇ                               ‚îÇ
‚îÇ                    host_name (FK)                       ‚îÇ
‚îÇ                         ‚îÇ                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ           –¢–∞–±–ª–∏—Ü–∞ xui_hosts (–•–æ—Å—Ç—ã)             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ host_name (PK) + squad_uuid (UNIQUE)   ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ remnawave_base_url + remnawave_api_token‚îÇ    ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ host_url + subscription_url             ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ SSH: host/port/user/password/key        ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ              ‚îÇ                                          ‚îÇ
‚îÇ         host_name (FK)                                  ‚îÇ
‚îÇ              ‚îÇ                                          ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ          –¢–∞–±–ª–∏—Ü–∞ vpn_keys (–ö–ª—é—á–∏)               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ key_id + email + remnawave_user_uuid   ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îÇ plan_id + host_name + metadata         ‚îÇ     ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ         –í–Ω–µ—à–Ω–∏–π Remnawave Server               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  API: https://panel.example.com/api/v1/        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  Squad UUID: –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å      ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  SSH: speedtest –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤          ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `xui_hosts`

**–§–∞–π–ª:** `src/shop_bot/data_manager/database.py` (—Å—Ç—Ä–æ–∫–∏ 220-250)

```sql
CREATE TABLE IF NOT EXISTS xui_hosts (
    host_name TEXT PRIMARY KEY,
    squad_uuid TEXT UNIQUE,
    remnawave_base_url TEXT,
    remnawave_api_token TEXT,
    host_url TEXT,
    subscription_url TEXT,
    ssh_host TEXT,
    ssh_port INTEGER DEFAULT 22,
    ssh_user TEXT,
    ssh_password TEXT,
    ssh_key_path TEXT,
    description TEXT,
    is_active INTEGER DEFAULT 1,
    sort_order INTEGER DEFAULT 0,
    metadata TEXT,
    created_at TEXT,
    updated_at TEXT,
    speedtest_last_run TEXT
)
```

### –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª–µ–π

| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|----------|
| `host_name` | TEXT (PK) | –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ö–æ—Å—Ç–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è) |
| `squad_uuid` | TEXT (UNIQUE) | UUID Squad –≤ Remnawave –¥–ª—è –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç–∏ |
| `remnawave_base_url` | TEXT | URL –ø–∞–Ω–µ–ª–∏ Remnawave (–Ω–∞–ø—Ä–∏–º–µ—Ä, `https://panel.example.com`) |
| `remnawave_api_token` | TEXT | API —Ç–æ–∫–µ–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Remnawave |
| `host_url` | TEXT | –ü—É–±–ª–∏—á–Ω—ã–π URL –ø–∞–Ω–µ–ª–∏ (–¥–ª—è –∞–¥–º–∏–Ω–æ–≤) |
| `subscription_url` | TEXT | URL –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `ssh_host` | TEXT | SSH –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ |
| `ssh_port` | INTEGER | SSH –ø–æ—Ä—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 22) |
| `ssh_user` | TEXT | SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| `ssh_password` | TEXT | SSH –ø–∞—Ä–æ–ª—å |
| `ssh_key_path` | TEXT | –ü—É—Ç—å –∫ SSH –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–ª—é—á—É |
| `description` | TEXT | –û–ø–∏—Å–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞ (–º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å JSON-–º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ) |
| `is_active` | INTEGER | –ê–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ö–æ—Å—Ç (1 = –¥–∞, 0 = –Ω–µ—Ç) |
| `sort_order` | INTEGER | –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ |
| `metadata` | TEXT | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (JSON) |
| `created_at` | TEXT | –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è (ISO 8601) |
| `updated_at` | TEXT | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
| `speedtest_last_run` | TEXT | –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ speedtest |

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω

**–§—É–Ω–∫—Ü–∏—è:** `normalize_host_name(name: str) -> str`

```python
def normalize_host_name(name: str) -> str:
    """–ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∏–º—è —Ö–æ—Å—Ç–∞: —É–±–∏—Ä–∞–µ—Ç –ø—Ä–æ–±–µ–ª—ã –∏ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ lowercase."""
    if name is None:
        return ""
    return name.strip().lower()
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ –∏–º–µ–Ω —Ö–æ—Å—Ç–æ–≤.

---

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Remnawave

### –ß—Ç–æ —Ç–∞–∫–æ–µ Remnawave?

**Remnawave** ‚Äî —ç—Ç–æ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN (–∞–Ω–∞–ª–æ–≥ 3x-ui), –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è:
- –°–æ–∑–¥–∞–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (VPN-–∫–ª—é—á–µ–π)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è subscription URL
- –ü–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è Squad (–º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å)

### Squad UUID –∏ –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å

**Squad** ‚Äî —ç—Ç–æ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è Remnawave –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ "–∫–æ–º–∞–Ω–¥–∞–º–∏" –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Remnawave Server (—Ñ–∏–∑–∏—á–µ—Å–∫–∏–π)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                        ‚îÇ
‚îÇ  ‚îî‚îÄ Squad 1 (aaaa-bbbb-cccc-dddd)      ‚îÇ
‚îÇ      ‚îú‚îÄ User 1 (email: user1@bot)      ‚îÇ
‚îÇ      ‚îú‚îÄ User 2 (email: user2@bot)      ‚îÇ
‚îÇ      ‚îî‚îÄ Inbound Config #1              ‚îÇ
‚îÇ                                        ‚îÇ
‚îÇ  ‚îî‚îÄ Squad 2 (eeee-ffff-gggg-hhhh)      ‚îÇ
‚îÇ      ‚îú‚îÄ User 3 (email: user3@bot)      ‚îÇ
‚îÇ      ‚îî‚îÄ Inbound Config #2              ‚îÇ
‚îÇ                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ö–∞–∂–¥—ã–π —Ö–æ—Å—Ç –≤ –±–æ—Ç–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–π `squad_uuid`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–æ—Ç–æ–≤/—Ñ—Ä–∞–Ω—à–∏–∑
- –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- –£–ø—Ä–∞–≤–ª—è—Ç—å —Ä–∞–∑–Ω—ã–º–∏ inbound –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏

### –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è API

**–§–∞–π–ª:** `src/shop_bot/modules/remnawave_api.py` (—Å—Ç—Ä–æ–∫–∏ 127-142)

```python
def _load_config_for_host(host_name: str) -> dict[str, Any]:
    """Load Remnawave API config for a specific host from xui_hosts."""
    if not host_name:
        raise RemnawaveAPIError("host_name is required")
    squad = rw_repo.get_squad(host_name)
    if not squad:
        raise RemnawaveAPIError(f"Host '{host_name}' not found")
    base_url = (squad.get("remnawave_base_url") or "").strip().rstrip("/")
    token = (squad.get("remnawave_api_token") or "").strip()
    if not base_url or not token:
        # Fallback to global config
        try:
            return _load_config()
        except RemnawaveAPIError:
            raise RemnawaveAPIError(f"Remnawave API settings are not configured for host '{host_name}'")
    return {"base_url": base_url, "token": token, "cookies": {}, "is_local": False}
```

### –ü–æ–∏—Å–∫ —Ö–æ—Å—Ç–∞ (get_squad)

**–§–∞–π–ª:** `src/shop_bot/data_manager/remnawave_repository.py` (—Å—Ç—Ä–æ–∫–∏ 87-107)

```python
def get_squad(identifier: str) -> dict[str, Any] | None:
    """–ù–∞–π—Ç–∏ —Ö–æ—Å—Ç –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ squad_uuid."""
    if not identifier:
        return None
    ident = identifier.strip()
    if not ident:
        return None
    normalized = normalize_host_name(ident)
    with _connect() as conn:
        cursor = conn.cursor()
        cursor.execute(
            """
            SELECT *
            FROM xui_hosts
            WHERE TRIM(host_name) = TRIM(?)
               OR TRIM(host_name) = TRIM(?)
               OR TRIM(squad_uuid) = TRIM(?)
               OR TRIM(squad_uuid) = TRIM(?)
            LIMIT 1
            """,
            (ident, normalized, ident, normalized),
        )
        row = cursor.fetchone()
        return dict(row) if row else None
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü–æ–∏—Å–∫ –ø–æ `host_name` (—Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –±–µ–∑)
- –ü–æ–∏—Å–∫ –ø–æ `squad_uuid` (—Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –±–µ–∑)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–≤–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ

---

## ‚öôÔ∏è CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞ (`create_host`)

**–§–∞–π–ª:** `src/shop_bot/data_manager/database.py` (—Å—Ç—Ä–æ–∫–∏ 983-1037)

```python
def create_host(
    name: str,
    url: str = "",
    user: str = "",
    passwd: str = "",
    inbound: str = "",
    subscription_url: str = "",
) -> None:
    """
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ö–æ—Å—Ç.
    
    Args:
        name: –ò–º—è —Ö–æ—Å—Ç–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è)
        url: URL –ø–∞–Ω–µ–ª–∏ Remnawave
        user: (—É—Å—Ç–∞—Ä–µ–ª–æ)
        passwd: (—É—Å—Ç–∞—Ä–µ–ª–æ)
        inbound: (—É—Å—Ç–∞—Ä–µ–ª–æ)
        subscription_url: URL –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫
    """
    name_n = normalize_host_name(name)
    now_iso = datetime.now(timezone.utc).isoformat()
    try:
        with sqlite3.connect(DB_FILE) as conn:
            cursor = conn.cursor()
            cursor.execute(
                """
                INSERT INTO xui_hosts(
                    host_name, host_url, subscription_url,
                    created_at, updated_at
                )
                VALUES (?, ?, ?, ?, ?)
                """,
                (name_n, url or "", subscription_url or "", now_iso, now_iso),
            )
            conn.commit()
            logging.info(f"‚úÖ –•–æ—Å—Ç '{name_n}' —Å–æ–∑–¥–∞–Ω")
    except sqlite3.IntegrityError as e:
        if "UNIQUE constraint failed: xui_hosts.host_name" in str(e):
            logging.error(f"‚ùå –•–æ—Å—Ç —Å –∏–º–µ–Ω–µ–º '{name_n}' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
            raise ValueError(f"–•–æ—Å—Ç —Å –∏–º–µ–Ω–µ–º '{name_n}' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç") from e
        else:
            logging.error(f"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ö–æ—Å—Ç–∞: {e}")
            raise
    except sqlite3.Error as e:
        logging.error(f"–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ö–æ—Å—Ç–∞: {e}")
        raise
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Remnawave –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–§–∞–π–ª:** `src/shop_bot/data_manager/database.py` (—Å—Ç—Ä–æ–∫–∏ 1096-1134)

```python
def update_host_remnawave_settings(
    host_name: str,
    remnawave_base_url: str = None,
    remnawave_api_token: str = None,
    squad_uuid: str = None,
) -> None:
    """
    –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Remnawave –¥–ª—è —Ö–æ—Å—Ç–∞.
    
    Args:
        host_name: –ò–º—è —Ö–æ—Å—Ç–∞
        remnawave_base_url: –ù–æ–≤—ã–π –±–∞–∑–æ–≤—ã–π URL
        remnawave_api_token: –ù–æ–≤—ã–π API —Ç–æ–∫–µ–Ω
        squad_uuid: –ù–æ–≤—ã–π Squad UUID
    """
    host_name_n = normalize_host_name(host_name)
    now_iso = datetime.now(timezone.utc).isoformat()
    updates = []
    values = []
    if remnawave_base_url is not None:
        updates.append("remnawave_base_url = ?")
        values.append(remnawave_base_url.strip())
    if remnawave_api_token is not None:
        updates.append("remnawave_api_token = ?")
        values.append(remnawave_api_token.strip())
    if squad_uuid is not None:
        updates.append("squad_uuid = ?")
        values.append(squad_uuid.strip() if squad_uuid else "")
    if not updates:
        return
    updates.append("updated_at = ?")
    values.append(now_iso)
    values.append(host_name_n)
    try:
        with sqlite3.connect(DB_FILE) as conn:
            cursor = conn.cursor()
            cursor.execute(
                f"UPDATE xui_hosts SET {', '.join(updates)} WHERE host_name=?",
                values,
            )
            conn.commit()
            if cursor.rowcount > 0:
                logging.info(f"‚úÖ Remnawave –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ö–æ—Å—Ç–∞ '{host_name_n}'")
            else:
                logging.warning(f"‚ö†Ô∏è –•–æ—Å—Ç '{host_name_n}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
    except sqlite3.Error as e:
        logging.error(f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è Remnawave –Ω–∞—Å—Ç—Ä–æ–µ–∫: {e}")
        raise
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSH –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–§–∞–π–ª:** `src/shop_bot/data_manager/database.py` (—Å—Ç—Ä–æ–∫–∏ 1136-1194)

```python
def update_host_ssh_settings(
    host_name: str,
    ssh_host: str = None,
    ssh_port: int = None,
    ssh_user: str = None,
    ssh_password: str = None,
    ssh_key_path: str = None,
) -> None:
    """
    –û–±–Ω–æ–≤–∏—Ç—å SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ö–æ—Å—Ç–∞ (–¥–ª—è speedtest –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞).
    
    Args:
        host_name: –ò–º—è —Ö–æ—Å—Ç–∞
        ssh_host: SSH –∞–¥—Ä–µ—Å
        ssh_port: SSH –ø–æ—Ä—Ç
        ssh_user: SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        ssh_password: SSH –ø–∞—Ä–æ–ª—å
        ssh_key_path: –ü—É—Ç—å –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –∫–ª—é—á—É
    """
    host_name_n = normalize_host_name(host_name)
    now_iso = datetime.now(timezone.utc).isoformat()
    updates = []
    values = []
    if ssh_host is not None:
        updates.append("ssh_host = ?")
        values.append(ssh_host.strip())
    if ssh_port is not None:
        updates.append("ssh_port = ?")
        values.append(ssh_port)
    if ssh_user is not None:
        updates.append("ssh_user = ?")
        values.append(ssh_user.strip())
    if ssh_password is not None:
        updates.append("ssh_password = ?")
        values.append(ssh_password)
    if ssh_key_path is not None:
        updates.append("ssh_key_path = ?")
        values.append(ssh_key_path.strip())
    if not updates:
        return
    updates.append("updated_at = ?")
    values.append(now_iso)
    values.append(host_name_n)
    try:
        with sqlite3.connect(DB_FILE) as conn:
            cursor = conn.cursor()
            cursor.execute(
                f"UPDATE xui_hosts SET {', '.join(updates)} WHERE host_name=?",
                values,
            )
            conn.commit()
            if cursor.rowcount > 0:
                logging.info(f"‚úÖ SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ö–æ—Å—Ç–∞ '{host_name_n}'")
            else:
                logging.warning(f"‚ö†Ô∏è –•–æ—Å—Ç '{host_name_n}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
    except sqlite3.Error as e:
        logging.error(f"–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è SSH –Ω–∞—Å—Ç—Ä–æ–µ–∫: {e}")
        raise
```

### 4. –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞

**–§–∞–π–ª:** `src/shop_bot/data_manager/database.py` (—Å—Ç—Ä–æ–∫–∏ 1076-1094)

```python
def update_host_name(old_name: str, new_name: str) -> None:
    """
    –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å —Ö–æ—Å—Ç (–æ–±–Ω–æ–≤–ª—è–µ—Ç host_name + –≤—Å–µ FK –≤ plans –∏ vpn_keys).
    
    Args:
        old_name: –°—Ç–∞—Ä–æ–µ –∏–º—è —Ö–æ—Å—Ç–∞
        new_name: –ù–æ–≤–æ–µ –∏–º—è —Ö–æ—Å—Ç–∞
    """
    old_n = normalize_host_name(old_name)
    new_n = normalize_host_name(new_name)
    now_iso = datetime.now(timezone.utc).isoformat()
    try:
        with sqlite3.connect(DB_FILE) as conn:
            cursor = conn.cursor()
            # –û–±–Ω–æ–≤–∏—Ç—å –∏–º—è —Ö–æ—Å—Ç–∞
            cursor.execute("UPDATE xui_hosts SET host_name=?, updated_at=? WHERE host_name=?", (new_n, now_iso, old_n))
            # –û–±–Ω–æ–≤–∏—Ç—å FK –≤ —Ç–∞—Ä–∏—Ñ–∞—Ö
            cursor.execute("UPDATE plans SET host_name=? WHERE host_name=?", (new_n, old_n))
            # –û–±–Ω–æ–≤–∏—Ç—å FK –≤ –∫–ª—é—á–∞—Ö
            cursor.execute("UPDATE vpn_keys SET host_name=? WHERE host_name=?", (new_n, old_n))
            conn.commit()
            logging.info(f"‚úÖ –•–æ—Å—Ç '{old_n}' –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ '{new_n}'")
    except sqlite3.Error as e:
        logging.error(f"–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ö–æ—Å—Ç–∞: {e}")
        raise
```

### 5. –£–¥–∞–ª–µ–Ω–∏–µ —Ö–æ—Å—Ç–∞

**–§–∞–π–ª:** `src/shop_bot/data_manager/database.py` (—Å—Ç—Ä–æ–∫–∏ 1196-1225)

```python
def delete_host(host_name: str) -> None:
    """
    –£–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤ –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º).
    
    Args:
        host_name: –ò–º—è —Ö–æ—Å—Ç–∞
        
    Raises:
        ValueError: –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–∞—Ä–∏—Ñ—ã, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–µ –∫ —Ö–æ—Å—Ç—É
    """
    host_name_n = normalize_host_name(host_name)
    try:
        with sqlite3.connect(DB_FILE) as conn:
            cursor = conn.cursor()
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤
            cursor.execute("SELECT COUNT(*) FROM plans WHERE host_name = ?", (host_name_n,))
            count = cursor.fetchone()[0]
            if count > 0:
                raise ValueError(f"–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç '{host_name_n}': —Å—É—â–µ—Å—Ç–≤—É–µ—Ç {count} —Ç–∞—Ä–∏—Ñ–æ–≤, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –∫ –Ω–µ–º—É")
            # –£–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç
            cursor.execute("DELETE FROM xui_hosts WHERE host_name=?", (host_name_n,))
            conn.commit()
            if cursor.rowcount > 0:
                logging.info(f"‚úÖ –•–æ—Å—Ç '{host_name_n}' —É–¥–∞–ª–µ–Ω")
            else:
                logging.warning(f"‚ö†Ô∏è –•–æ—Å—Ç '{host_name_n}' –Ω–µ –Ω–∞–π–¥–µ–Ω")
    except sqlite3.Error as e:
        logging.error(f"–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∞: {e}")
        raise
```

### 6. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ö–æ—Å—Ç–∞

**–§–∞–π–ª:** `src/shop_bot/data_manager/database.py` (—Å—Ç—Ä–æ–∫–∏ 1227-1244)

```python
def get_host(host_name: str) -> dict | None:
    """
    –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö–æ—Å—Ç–µ –ø–æ –∏–º–µ–Ω–∏.
    
    Returns:
        dict –∏–ª–∏ None –µ—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω
    """
    host_name_n = normalize_host_name(host_name)
    try:
        with sqlite3.connect(DB_FILE) as conn:
            conn.row_factory = sqlite3.Row
            cursor = conn.cursor()
            cursor.execute("SELECT * FROM xui_hosts WHERE host_name=?", (host_name_n,))
            row = cursor.fetchone()
            if row:
                return dict(row)
            return None
    except sqlite3.Error as e:
        logging.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ö–æ—Å—Ç–∞: {e}")
        return None
```

### 7. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤

**–§–∞–π–ª:** `src/shop_bot/data_manager/database.py` (—Å—Ç—Ä–æ–∫–∏ 1259-1276)

```python
def get_all_hosts() -> list[dict]:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤.
    
    Returns:
        –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π —Å –¥–∞–Ω–Ω—ã–º–∏ —Ö–æ—Å—Ç–æ–≤
    """
    try:
        with sqlite3.connect(DB_FILE) as conn:
            conn.row_factory = sqlite3.Row
            cursor = conn.cursor()
            cursor.execute("SELECT * FROM xui_hosts")
            hosts = cursor.fetchall()
            result = []
            for row in hosts:
                d = dict(row)
                d['host_name'] = normalize_host_name(d.get('host_name'))
                result.append(d)
            return result
    except sqlite3.Error as e:
        logging.error(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤: {e}")
        return []
```

---

## üñ•Ô∏è SSH –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Speedtest —á–µ—Ä–µ–∑ SSH

–ë–æ—Ç –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å speedtest –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ —á–µ—Ä–µ–∑ SSH –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

**–¢–∞–±–ª–∏—Ü–∞ `speedtest_results`:**

```sql
CREATE TABLE IF NOT EXISTS speedtest_results (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    host_name TEXT NOT NULL,
    timestamp TEXT NOT NULL,
    download_speed REAL,
    upload_speed REAL,
    ping REAL,
    metadata TEXT
)
```

**–§–∞–π–ª:** `src/shop_bot/data_manager/speedtest_runner.py`

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤

**–§–∞–π–ª:** `src/shop_bot/data_manager/resource_monitor.py`

–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç:
- CPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- RAM –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- Disk –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
- Network —Ç—Ä–∞—Ñ–∏–∫

—á–µ—Ä–µ–∑ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É.

---

## üéõÔ∏è –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. Telegram Bot (Admin Panel)

**–§–∞–π–ª:** `src/shop_bot/bot/admin_handlers.py` (—Å—Ç—Ä–æ–∫–∏ 1914-2120)

#### –ú–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∞–º–∏

```python
async def show_admin_hosts_menu(message: Message, *, edit: bool = False):
    """–ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∞–º–∏."""
    hosts = get_all_hosts()
    text = "üñ• <b>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–æ—Å—Ç–∞–º–∏</b>\n\n"
    if hosts:
        text += "üìã <b>–°–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤:</b>\n"
        for h in hosts:
            name = h.get("host_name", "")
            url = h.get("host_url", "")
            active = "‚úÖ" if h.get("is_active", 1) else "‚ùå"
            text += f"{active} <code>{name}</code> ‚Äî {url}\n"
    else:
        text += "‚ö†Ô∏è –•–æ—Å—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.\n"
    text += "\nüí° –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:"
    kb = keyboards.get_admin_hosts_keyboard()
    if edit:
        await message.edit_text(text, reply_markup=kb)
    else:
        await message.answer(text, reply_markup=kb)
```

#### –°–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∞

```python
class AdminHosts(StatesGroup):
    menu = State()
    waiting_add_name = State()
    waiting_add_base_url = State()
    waiting_add_api_token = State()
    waiting_add_squad_uuid = State()
    waiting_edit_host_select = State()
    # ... –¥—Ä—É–≥–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```

#### –ü—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∞

```python
@router.message(AdminHosts.waiting_add_name)
async def admin_hosts_add_step2(message: Message, state: FSMContext):
    """–ü–æ–ª—É—á–∏—Ç—å –∏–º—è –Ω–æ–≤–æ–≥–æ —Ö–æ—Å—Ç–∞."""
    name = message.text.strip()
    if not name:
        await message.answer("‚ùå –ò–º—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.")
        return
    await state.update_data(new_host_name=name)
    await message.answer("üìù –í–≤–µ–¥–∏—Ç–µ –±–∞–∑–æ–≤—ã–π URL Remnawave\n(–Ω–∞–ø—Ä–∏–º–µ—Ä: https://panel.example.com):")
    await state.set_state(AdminHosts.waiting_add_base_url)

@router.message(AdminHosts.waiting_add_base_url)
async def admin_hosts_add_step3(message: Message, state: FSMContext):
    """–ü–æ–ª—É—á–∏—Ç—å –±–∞–∑–æ–≤—ã–π URL."""
    base_url = message.text.strip()
    await state.update_data(remnawave_base_url=base_url)
    await message.answer("üîë –í–≤–µ–¥–∏—Ç–µ API Token –¥–ª—è Remnawave:")
    await state.set_state(AdminHosts.waiting_add_api_token)

@router.message(AdminHosts.waiting_add_api_token)
async def admin_hosts_add_step4(message: Message, state: FSMContext):
    """–ü–æ–ª—É—á–∏—Ç—å API —Ç–æ–∫–µ–Ω."""
    api_token = message.text.strip()
    await state.update_data(remnawave_api_token=api_token)
    await message.answer("üÜî –í–≤–µ–¥–∏—Ç–µ Squad UUID (–∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ '-' —á—Ç–æ–±—ã –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å):")
    await state.set_state(AdminHosts.waiting_add_squad_uuid)

@router.message(AdminHosts.waiting_add_squad_uuid)
async def admin_hosts_add_complete(message: Message, state: FSMContext):
    """–ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞."""
    squad_uuid = message.text.strip()
    if squad_uuid == "-":
        squad_uuid = ""
    data = await state.get_data()
    try:
        create_host(
            name=data["new_host_name"],
            url="",
            subscription_url=""
        )
        update_host_remnawave_settings(
            host_name=data["new_host_name"],
            remnawave_base_url=data["remnawave_base_url"],
            remnawave_api_token=data["remnawave_api_token"],
            squad_uuid=squad_uuid
        )
        await message.answer(f"‚úÖ –•–æ—Å—Ç '{data['new_host_name']}' —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!")
        await state.clear()
        await show_admin_hosts_menu(message)
    except Exception as e:
        await message.answer(f"‚ùå –û—à–∏–±–∫–∞: {e}")
```

### 2. Web Interface (Flask)

**–§–∞–π–ª:** `src/shop_bot/webhook_server/app.py`

#### –ú–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è —Ö–æ—Å—Ç–æ–≤

```python
@app.route("/add-host", methods=["POST"])
@requires_auth
def add_host_route():
    """–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ö–æ—Å—Ç —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å."""
    host_name = request.form.get("host_name", "").strip()
    remnawave_base_url = request.form.get("remnawave_base_url", "").strip()
    remnawave_api_token = request.form.get("remnawave_api_token", "").strip()
    squad_uuid = request.form.get("squad_uuid", "").strip()
    try:
        database.create_host(host_name, subscription_url="")
        database.update_host_remnawave_settings(
            host_name,
            remnawave_base_url=remnawave_base_url,
            remnawave_api_token=remnawave_api_token,
            squad_uuid=squad_uuid
        )
        flash(f"–•–æ—Å—Ç '{host_name}' —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω", "success")
    except Exception as e:
        flash(f"–û—à–∏–±–∫–∞: {e}", "danger")
    return redirect(url_for("settings_page"))

@app.route("/delete-host/<host_name>", methods=["POST"])
@requires_auth
def delete_host_route(host_name):
    """–£–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç."""
    try:
        database.delete_host(host_name)
        flash(f"–•–æ—Å—Ç '{host_name}' —É–¥–∞–ª–µ–Ω", "success")
    except ValueError as e:
        flash(str(e), "danger")
    except Exception as e:
        flash(f"–û—à–∏–±–∫–∞: {e}", "danger")
    return redirect(url_for("settings_page"))

@app.route("/update-host-remnawave", methods=["POST"])
@requires_auth
def update_host_remnawave_route():
    """–û–±–Ω–æ–≤–∏—Ç—å Remnawave –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö–æ—Å—Ç–∞."""
    host_name = request.form.get("host_name")
    remnawave_base_url = request.form.get("remnawave_base_url")
    remnawave_api_token = request.form.get("remnawave_api_token")
    squad_uuid = request.form.get("squad_uuid")
    try:
        database.update_host_remnawave_settings(
            host_name,
            remnawave_base_url=remnawave_base_url,
            remnawave_api_token=remnawave_api_token,
            squad_uuid=squad_uuid
        )
        flash(f"Remnawave –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ö–æ—Å—Ç–∞ '{host_name}'", "success")
    except Exception as e:
        flash(f"–û—à–∏–±–∫–∞: {e}", "danger")
    return redirect(url_for("settings_page"))

@app.route("/update-host-ssh", methods=["POST"])
@requires_auth
def update_host_ssh_route():
    """–û–±–Ω–æ–≤–∏—Ç—å SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ö–æ—Å—Ç–∞."""
    host_name = request.form.get("host_name")
    ssh_host = request.form.get("ssh_host")
    ssh_port = request.form.get("ssh_port", type=int)
    ssh_user = request.form.get("ssh_user")
    ssh_password = request.form.get("ssh_password")
    ssh_key_path = request.form.get("ssh_key_path")
    try:
        database.update_host_ssh_settings(
            host_name,
            ssh_host=ssh_host,
            ssh_port=ssh_port,
            ssh_user=ssh_user,
            ssh_password=ssh_password,
            ssh_key_path=ssh_key_path
        )
        flash(f"SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ö–æ—Å—Ç–∞ '{host_name}'", "success")
    except Exception as e:
        flash(f"–û—à–∏–±–∫–∞: {e}", "danger")
    return redirect(url_for("settings_page"))
```

#### UI —Ñ–æ—Ä–º–∞ (HTML)

**–§–∞–π–ª:** `src/shop_bot/webhook_server/templates/settings.html` (—Å—Ç—Ä–æ–∫–∏ 144-200)

```html
<h2>
    <i class="ti ti-server me-2"></i>
    –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –•–æ—Å—Ç–∞–º–∏ (–°–µ—Ä–≤–µ—Ä–∞–º–∏)
</h2>

<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∞ -->
<div class="host-card">
    <h4>
        <i class="ti ti-plus me-2"></i>
        –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ö–æ—Å—Ç
    </h4>
    <form action="{{ url_for('add_host_route') }}" method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
        <div class="form-group">
            <label for="host_name">–ù–∞–∑–≤–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞:</label>
            <input type="text" id="host_name" name="host_name" required />
        </div>
        <div class="form-group">
            <label for="remnawave_base_url">–ë–∞–∑–æ–≤—ã–π URL Remnawave:</label>
            <input type="url" id="remnawave_base_url" name="remnawave_base_url" placeholder="https://panel.example.com" required />
        </div>
        <div class="form-group password-wrapper">
            <label for="remnawave_api_token">API Token:</label>
            <input type="password" id="remnawave_api_token" name="remnawave_api_token" required />
            <button type="button" class="toggle-password">üëÅÔ∏è</button>
        </div>
        <div class="form-group">
            <label for="squad_uuid">Squad UUID:</label>
            <input type="text" id="squad_uuid" name="squad_uuid" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" />
        </div>
        <button type="submit" class="btn btn-primary">
            <i class="ti ti-plus me-1"></i>
            –î–æ–±–∞–≤–∏—Ç—å —Ö–æ—Å—Ç
        </button>
    </form>
</div>

<!-- –°–ø–∏—Å–æ–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ö–æ—Å—Ç–æ–≤ -->
{% if hosts %}
    {% for host in hosts %}
    <details class="host-card rw-drawer rw-drawer-host">
        <summary class="host-header rw-drawer-summary">
            <h3>{{ host.host_name }}</h3>
            <span class="rw-drawer-caret" aria-hidden="true"></span>
            <form action="{{ url_for('delete_host_route', host_name=host.host_name) }}" method="post" data-confirm="–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ö–æ—Å—Ç –∏ –≤—Å–µ –µ–≥–æ —Ç–∞—Ä–∏—Ñ—ã?">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                <button type="submit" class="btn btn-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
            </form>
        </summary>
        <div class="rw-drawer-body">
            <!-- –§–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        </div>
    </details>
    {% endfor %}
{% endif %}
```

---

## üìö API Reference

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `create_host(name, url, user, passwd, inbound, subscription_url)`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–π —Ö–æ—Å—Ç
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `name` (str): –ò–º—è —Ö–æ—Å—Ç–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
  - `url` (str): URL –ø–∞–Ω–µ–ª–∏
  - `user` (str): (—É—Å—Ç–∞—Ä–µ–ª–æ)
  - `passwd` (str): (—É—Å—Ç–∞—Ä–µ–ª–æ)
  - `inbound` (str): (—É—Å—Ç–∞—Ä–µ–ª–æ)
  - `subscription_url` (str): URL –ø–æ–¥–ø–∏—Å–∫–∏
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None
- **–ò—Å–∫–ª—é—á–µ–Ω–∏—è:** 
  - `ValueError` ‚Äî –µ—Å–ª–∏ —Ö–æ—Å—Ç —Å —Ç–∞–∫–∏–º –∏–º–µ–Ω–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
  - `sqlite3.Error` ‚Äî –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ë–î

#### `update_host_remnawave_settings(host_name, remnawave_base_url, remnawave_api_token, squad_uuid)`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±–Ω–æ–≤–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Remnawave –¥–ª—è —Ö–æ—Å—Ç–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `host_name` (str): –ò–º—è —Ö–æ—Å—Ç–∞
  - `remnawave_base_url` (str, optional): –ù–æ–≤—ã–π URL
  - `remnawave_api_token` (str, optional): –ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω
  - `squad_uuid` (str, optional): –ù–æ–≤—ã–π Squad UUID
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

#### `update_host_ssh_settings(host_name, ssh_host, ssh_port, ssh_user, ssh_password, ssh_key_path)`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±–Ω–æ–≤–ª—è–µ—Ç SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ö–æ—Å—Ç–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `host_name` (str): –ò–º—è —Ö–æ—Å—Ç–∞
  - `ssh_host` (str, optional): SSH –∞–¥—Ä–µ—Å
  - `ssh_port` (int, optional): SSH –ø–æ—Ä—Ç
  - `ssh_user` (str, optional): SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
  - `ssh_password` (str, optional): SSH –ø–∞—Ä–æ–ª—å
  - `ssh_key_path` (str, optional): –ü—É—Ç—å –∫ –∫–ª—é—á—É
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

#### `update_host_name(old_name, new_name)`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç —Ö–æ—Å—Ç –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤—Å–µ FK
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `old_name` (str): –°—Ç–∞—Ä–æ–µ –∏–º—è
  - `new_name` (str): –ù–æ–≤–æ–µ –∏–º—è
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

#### `update_host_url(host_name, new_url)`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±–Ω–æ–≤–ª—è–µ—Ç URL –ø–∞–Ω–µ–ª–∏ —Ö–æ—Å—Ç–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `host_name` (str): –ò–º—è —Ö–æ—Å—Ç–∞
  - `new_url` (str): –ù–æ–≤—ã–π URL
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

#### `update_host_subscription_url(host_name, new_subscription_url)`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –û–±–Ω–æ–≤–ª—è–µ—Ç URL –ø–æ–¥–ø–∏—Å–∫–∏ —Ö–æ—Å—Ç–∞
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `host_name` (str): –ò–º—è —Ö–æ—Å—Ç–∞
  - `new_subscription_url` (str): –ù–æ–≤—ã–π URL –ø–æ–¥–ø–∏—Å–∫–∏
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None

#### `delete_host(host_name)`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –£–¥–∞–ª—è–µ—Ç —Ö–æ—Å—Ç (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–∞—Ä–∏—Ñ–æ–≤)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `host_name` (str): –ò–º—è —Ö–æ—Å—Ç–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** None
- **–ò—Å–∫–ª—é—á–µ–Ω–∏—è:**
  - `ValueError` ‚Äî –µ—Å–ª–∏ –µ—Å—Ç—å —Ç–∞—Ä–∏—Ñ—ã –Ω–∞ —ç—Ç–æ–º —Ö–æ—Å—Ç–µ

#### `get_host(host_name)`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ö–æ—Å—Ç–µ
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `host_name` (str): –ò–º—è —Ö–æ—Å—Ç–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** dict | None

#### `get_all_hosts()`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** –ù–µ—Ç
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** list[dict]

#### `get_squad(identifier)`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–∞—Ö–æ–¥–∏—Ç —Ö–æ—Å—Ç –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ squad_uuid
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `identifier` (str): –ò–º—è —Ö–æ—Å—Ç–∞ –∏–ª–∏ Squad UUID
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** dict | None

#### `normalize_host_name(name)`
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –∏–º—è —Ö–æ—Å—Ç–∞ (lowercase + strip)
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
  - `name` (str): –ò–º—è —Ö–æ—Å—Ç–∞
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** str

---

## üí° –ü—Ä–∏–º–µ—Ä—ã

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ö–æ—Å—Ç–∞

```python
from src.shop_bot.data_manager import database

# 1. –°–æ–∑–¥–∞—Ç—å —Ö–æ—Å—Ç
database.create_host(
    name="Server-EU-1",
    url="",
    subscription_url=""
)

# 2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Remnawave
database.update_host_remnawave_settings(
    host_name="server-eu-1",  # –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
    remnawave_base_url="https://panel-eu.example.com",
    remnawave_api_token="your-api-token-here",
    squad_uuid="aaaa-bbbb-cccc-dddd"
)

# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSH
database.update_host_ssh_settings(
    host_name="server-eu-1",
    ssh_host="185.123.45.67",
    ssh_port=22,
    ssh_user="root",
    ssh_password="your-password",
    ssh_key_path="/root/.ssh/id_rsa"
)

print("‚úÖ –•–æ—Å—Ç —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!")
```

### –ü—Ä–∏–º–µ—Ä 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤

```python
hosts = database.get_all_hosts()
for host in hosts:
    print(f"üñ• {host['host_name']}")
    print(f"   URL: {host['host_url']}")
    print(f"   Squad UUID: {host['squad_uuid']}")
    print(f"   –ê–∫—Ç–∏–≤–µ–Ω: {'–î–∞' if host['is_active'] else '–ù–µ—Ç'}")
    print()
```

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–∏—Å–∫ —Ö–æ—Å—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª—é—á–∞

```python
from src.shop_bot.data_manager import remnawave_repository as rw_repo

# –ù–∞–π—Ç–∏ —Ö–æ—Å—Ç –ø–æ –∏–º–µ–Ω–∏
host = rw_repo.get_squad("server-eu-1")
if host:
    print(f"–ù–∞–π–¥–µ–Ω —Ö–æ—Å—Ç: {host['host_name']}")
    print(f"Remnawave URL: {host['remnawave_base_url']}")
    print(f"Squad UUID: {host['squad_uuid']}")
else:
    print("–•–æ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω")

# –ù–∞–π—Ç–∏ —Ö–æ—Å—Ç –ø–æ Squad UUID
host_by_uuid = rw_repo.get_squad("aaaa-bbbb-cccc-dddd")
if host_by_uuid:
    print(f"–ù–∞–π–¥–µ–Ω —Ö–æ—Å—Ç: {host_by_uuid['host_name']}")
```

### –ü—Ä–∏–º–µ—Ä 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ URL –ø–æ–¥–ø–∏—Å–∫–∏

```python
database.update_host_subscription_url(
    host_name="server-eu-1",
    new_subscription_url="https://sub.example.com/api/v1/client/subscribe?token={KEY}"
)
print("‚úÖ URL –ø–æ–¥–ø–∏—Å–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω")
```

### –ü—Ä–∏–º–µ—Ä 5: –£–¥–∞–ª–µ–Ω–∏–µ —Ö–æ—Å—Ç–∞

```python
try:
    database.delete_host("server-eu-1")
    print("‚úÖ –•–æ—Å—Ç —É–¥–∞–ª–µ–Ω")
except ValueError as e:
    print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
    # –ù–∞–ø—Ä–∏–º–µ—Ä: "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç 'server-eu-1': —Å—É—â–µ—Å—Ç–≤—É–µ—Ç 5 —Ç–∞—Ä–∏—Ñ–æ–≤, –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã—Ö –∫ –Ω–µ–º—É"
```

---

## üîó –°–≤—è–∑—å —Å —Ç–∞—Ä–∏—Ñ–∞–º–∏ –∏ –∫–ª—é—á–∞–º–∏

### –í–∑–∞–∏–º–æ—Å–≤—è–∑–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    –¢–∞–±–ª–∏—Ü–∞: xui_hosts                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ host_name (PK)                                 ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ squad_uuid (UNIQUE)                            ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ remnawave_base_url + remnawave_api_token       ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ                   ‚îÇ
         host_name (FK)      host_name (FK)
              ‚îÇ                   ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚îÇ  –¢–∞–±–ª–∏—Ü–∞: plans ‚îÇ   ‚îÇ –¢–∞–±–ª–∏—Ü–∞: vpn_keys‚îÇ
     ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
     ‚îÇ plan_id (PK)    ‚îÇ   ‚îÇ key_id (PK)      ‚îÇ
     ‚îÇ host_name       ‚îÇ   ‚îÇ host_name        ‚îÇ
     ‚îÇ name            ‚îÇ   ‚îÇ plan_id (FK)     ‚îÇ
     ‚îÇ price           ‚îÇ   ‚îÇ email            ‚îÇ
     ‚îÇ duration_days   ‚îÇ   ‚îÇ remnawave_uuid   ‚îÇ
     ‚îÇ traffic_limit   ‚îÇ   ‚îÇ description      ‚îÇ
     ‚îÇ description     ‚îÇ   ‚îÇ (JSON metadata)  ‚îÇ
     ‚îÇ (JSON metadata) ‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞—Ä–∏—Ñ–∞:**
   ```python
   database.create_plan(
       name="Premium 1 –º–µ—Å—è—Ü",
       price=500,
       duration_days=30,
       traffic_limit_gb=100,
       host_name="server-eu-1"  # –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Ö–æ—Å—Ç—É
   )
   ```

2. **–ü–æ–∫—É–ø–∫–∞ –∫–ª—é—á–∞:**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —Ç–∞—Ä–∏—Ñ
   - –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç `host_name` –∏–∑ —Ç–∞—Ä–∏—Ñ–∞
   - –ë–æ—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç squad –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `get_squad(host_name)`
   - –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç –∫–ª—é—á –Ω–∞ Remnawave API –∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ —Ö–æ—Å—Ç–∞
   - –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–ª—é—á –≤ `vpn_keys` —Å `host_name`

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞:**
   ```python
   # –ü–æ–ª—É—á–∏—Ç—å —Ö–æ—Å—Ç –∫–ª—é—á–∞
   key = database.get_key_by_id(123)
   host_name = key['host_name']
   
   # –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è API
   config = remnawave_api._load_config_for_host(host_name)
   
   # –û–±–Ω–æ–≤–∏—Ç—å –∫–ª—é—á —á–µ—Ä–µ–∑ API
   await remnawave_api.update_user(
       user_uuid=key['remnawave_user_uuid'],
       data={...}
   )
   ```

### –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏

–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –∫–ª—é—á–∞ –≤ –ø–æ–ª–µ `description` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è JSON —Å –¥–∞–Ω–Ω—ã–º–∏ —Ç–∞—Ä–∏—Ñ–∞ –∏ —Ö–æ—Å—Ç–∞:

```json
{
  "plan_name": "Premium 1 –º–µ—Å—è—Ü",
  "plan_price": 500,
  "plan_duration_days": 30,
  "plan_traffic_limit_gb": 100,
  "host_name": "server-eu-1",
  "host_url": "https://panel-eu.example.com",
  "subscription_url": "https://sub.example.com/...",
  "purchase_date": "2025-02-01T12:00:00Z"
}
```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∫—É–ø–∫–∏ –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–∞—Ä–∏—Ñ/—Ö–æ—Å—Ç –∏–∑–º–µ–Ω–∏—Ç—Å—è
- ‚úÖ –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –±—ã–ª–∏ –Ω–∞ –º–æ–º–µ–Ω—Ç –ø–æ–∫—É–ø–∫–∏
- ‚úÖ –ù–µ —Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —Ç–∞—Ä–∏—Ñ–æ–≤

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### 1. –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∏–º–µ–Ω
–í—Å–µ –∏–º–µ–Ω–∞ —Ö–æ—Å—Ç–æ–≤ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ `lowercase` –∏ –æ–±—Ä–µ–∑–∞—é—Ç—Å—è –æ—Ç –ø—Ä–æ–±–µ–ª–æ–≤. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:
- `"Server-EU-1"` ‚Üí `"server-eu-1"`
- `" My Host "` ‚Üí `"my host"`

### 2. –ó–∞—â–∏—Ç–∞ –æ—Ç —É–¥–∞–ª–µ–Ω–∏—è
–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç, –µ—Å–ª–∏ –∫ –Ω–µ–º—É –ø—Ä–∏–≤—è–∑–∞–Ω—ã —Ç–∞—Ä–∏—Ñ—ã. –°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∏–ª–∏ –ø–µ—Ä–µ–ø—Ä–∏–≤—è–∑–∞—Ç—å –≤—Å–µ —Ç–∞—Ä–∏—Ñ—ã.

### 3. –ö–∞—Å–∫–∞–¥–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏
–ü—Ä–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–∏ —Ö–æ—Å—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è:
- –í—Å–µ —Ç–∞—Ä–∏—Ñ—ã (`plans.host_name`)
- –í—Å–µ –∫–ª—é—á–∏ (`vpn_keys.host_name`)

### 4. Fallback –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
–ï—Å–ª–∏ –¥–ª—è —Ö–æ—Å—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω—ã Remnawave –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ `.env`:
- `REMNAWAVE_BASE_URL`
- `REMNAWAVE_API_TOKEN`

### 5. Squad UUID –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω
–ï—Å–ª–∏ `squad_uuid` –Ω–µ —É–∫–∞–∑–∞–Ω, API –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º Squad –≤ Remnawave.

---

## üîç Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "Host not found"

**–ü—Ä–∏—á–∏–Ω–∞:** –•–æ—Å—Ç —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –∏–º–µ–Ω–µ–º –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ë–î.

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ
host = database.get_host("server-eu-1")
if not host:
    print("–•–æ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º...")
    database.create_host("server-eu-1", subscription_url="")
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Remnawave API settings are not configured"

**–ü—Ä–∏—á–∏–Ω–∞:** –î–ª—è —Ö–æ—Å—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω—ã `remnawave_base_url` –∏–ª–∏ `remnawave_api_token`.

**–†–µ—à–µ–Ω–∏–µ:**
```python
database.update_host_remnawave_settings(
    host_name="server-eu-1",
    remnawave_base_url="https://panel.example.com",
    remnawave_api_token="your-token"
)
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç: —Å—É—â–µ—Å—Ç–≤—É–µ—Ç N —Ç–∞—Ä–∏—Ñ–æ–≤"

**–ü—Ä–∏—á–∏–Ω–∞:** –ö —Ö–æ—Å—Ç—É –ø—Ä–∏–≤—è–∑–∞–Ω—ã —Ç–∞—Ä–∏—Ñ—ã.

**–†–µ—à–µ–Ω–∏–µ:**
```python
# 1. –ü–æ–ª—É—á–∏—Ç—å —Ç–∞—Ä–∏—Ñ—ã —Ö–æ—Å—Ç–∞
plans = database.get_plans_by_host("server-eu-1")

# 2. –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ç–∞—Ä–∏—Ñ—ã
for plan in plans:
    database.delete_plan(plan['plan_id'])

# 3. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç
database.delete_host("server-eu-1")
```

### –ü—Ä–æ–±–ª–µ–º–∞: SSH –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã SSH –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å/–∫–ª—é—á.

**–†–µ—à–µ–Ω–∏–µ:**
```python
database.update_host_ssh_settings(
    host_name="server-eu-1",
    ssh_host="185.123.45.67",
    ssh_port=22,
    ssh_user="root",
    ssh_password="correct-password"
)
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Ö–æ—Å—Ç–∞–º

```python
def get_host_statistics():
    """–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –≤—Å–µ–º —Ö–æ—Å—Ç–∞–º."""
    hosts = database.get_all_hosts()
    stats = []
    for host in hosts:
        host_name = host['host_name']
        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞—Ä–∏—Ñ–æ–≤
        plans = database.get_plans_by_host(host_name)
        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª—é—á–µ–π
        keys = database.get_keys_by_host(host_name)
        active_keys = [k for k in keys if k.get('status') == 'active']
        stats.append({
            'host': host_name,
            'plans_count': len(plans),
            'keys_total': len(keys),
            'keys_active': len(active_keys)
        })
    return stats
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ö–æ—Å—Ç–æ–≤

```python
from src.shop_bot.data_manager import resource_monitor

async def check_all_hosts_health():
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤."""
    hosts = database.get_all_hosts()
    for host in hosts:
        if not host.get('ssh_host'):
            continue
        try:
            stats = await resource_monitor.get_system_stats(
                ssh_host=host['ssh_host'],
                ssh_port=host['ssh_port'],
                ssh_user=host['ssh_user'],
                ssh_password=host['ssh_password']
            )
            print(f"‚úÖ {host['host_name']}: CPU {stats['cpu']}%, RAM {stats['ram']}%")
        except Exception as e:
            print(f"‚ùå {host['host_name']}: {e}")
```

---

## üéì –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∞–º–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
- ‚úÖ –ì–∏–±–∫—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–Ω–æ–∂–µ—Å—Ç–≤–∞ VPN-—Å–µ—Ä–≤–µ—Ä–æ–≤
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å Remnawave API (–≤–∫–ª—é—á–∞—è –º—É–ª—å—Ç–∏—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å)
- ‚úÖ SSH –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ speedtest
- ‚úÖ –ü—Ä–∏–≤—è–∑–∫—É —Ç–∞—Ä–∏—Ñ–æ–≤ –∏ –∫–ª—é—á–µ–π –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Å–µ—Ä–≤–µ—Ä–∞–º
- ‚úÖ –£–¥–æ–±–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Telegram –±–æ—Ç + web –ø–∞–Ω–µ–ª—å)

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- [src/shop_bot/data_manager/database.py](src/shop_bot/data_manager/database.py) ‚Äî CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
- [src/shop_bot/bot/admin_handlers.py](src/shop_bot/bot/admin_handlers.py) ‚Äî Telegram –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- [src/shop_bot/webhook_server/app.py](src/shop_bot/webhook_server/app.py) ‚Äî Web –º–∞—Ä—à—Ä—É—Ç—ã
- [src/shop_bot/modules/remnawave_api.py](src/shop_bot/modules/remnawave_api.py) ‚Äî API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [src/shop_bot/data_manager/remnawave_repository.py](src/shop_bot/data_manager/remnawave_repository.py) ‚Äî –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ö–æ—Å—Ç–æ–≤

**–°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
- [TARIFFS_GUIDE.md](TARIFFS_GUIDE.md) ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º
- [VPN_KEYS_DOCUMENTATION.md](VPN_KEYS_DOCUMENTATION.md) ‚Äî –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∫–ª—é—á–∞–º

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–∞ –Ω–∞ 2025 –≥–æ–¥. –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –∏–ª–∏ API –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.*

# ü§ñ –°–∏—Å—Ç–µ–º–∞ –ö–∞–ø—á–∏ - –ö—Ä–∞—Ç–∫–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## –ß—Ç–æ —ç—Ç–æ?

–°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã –±–æ—Ç–∞ –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π –∏ –ø–æ–¥–¥–µ–ª—å–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ Telegram. –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ –ø—Ä–æ—Å—Ç—É—é –∫–∞–ø—á—É –ø–µ—Ä–µ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–µ–π.

## –î–≤–∞ —Ç–∏–ø–∞ –∫–∞–ø—á–∏

### 1Ô∏è‚É£ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
```
‚ùì 45 + 27 = ?
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: 72
```

**–û–ø–µ—Ä–∞—Ü–∏–∏:** —Å–ª–æ–∂–µ–Ω–∏–µ, –≤—ã—á–∏—Ç–∞–Ω–∏–µ, —É–º–Ω–æ–∂–µ–Ω–∏–µ

### 2Ô∏è‚É£ –ö–Ω–æ–ø–æ—á–Ω–∞—è (—Å –≤—ã–±–æ—Ä–æ–º —Å–º–∞–π–ª–∏–∫–∞)
```
‚ùì –ö–∞–∫–æ–π —Å–º–∞–π–ª–∏–∫ –æ–∑–Ω–∞—á–∞–µ—Ç —É–ª—ã–±–∫—É?

[üòä] [üëç] [üî•] [‚ù§Ô∏è]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç: üòä
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–ø—á–µ–π (–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã)

### 1. –û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
1. –ù–∞–∂–º–∏—Ç–µ `/admin` –≤ –±–æ—Ç–µ
2. –í—ã–±–µ—Ä–∏—Ç–µ **"‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"ü§ñ –ö–∞–ø—á–∞"**

### 2. –û—Å–Ω–æ–≤–Ω—ã–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

| –ö–Ω–æ–ø–∫–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|--------|----------|
| ‚úÖ/‚ùå –í–∫–ª—é—á–∏—Ç—å/–û—Ç–∫–ª—é—á–∏—Ç—å | –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–∞–ø—á–∏ |
| üìù –¢–∏–ø –∫–∞–ø—á–∏ | –í—ã–±—Ä–∞—Ç—å —Ç–∏–ø (Math –∏–ª–∏ Button) |
| üî¢ –ú–∞–∫—Å. –ø–æ–ø—ã—Ç–æ–∫ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ (1-10) |
| ‚è±Ô∏è Timeout | –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–∞–ø—á–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö (5-120) |
| üí¨ –°–æ–æ–±—â–µ–Ω–∏–µ | –ö–∞—Å—Ç–æ–º–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∫ –∫–∞–ø—á–µ |

## –ü–æ—Ç–æ–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å –∫–∞–ø—á–µ–π

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí /start
    ‚Üì
[–ï—Å–ª–∏ –∫–∞–ø—á–∞ –≤–∫–ª—é—á–µ–Ω–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–æ–≤—ã–π]
    ‚Üì
–ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–ø—á—É
(–º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ò–õ–ò —Å –∫–Ω–æ–ø–∫–∞–º–∏)
    ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç
    ‚Üì
–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
‚îú‚îÄ ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ ‚Üí –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
‚îî‚îÄ ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Üí –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫—É (–º–∞–∫—Å. 3)
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

```
–ö–∞–ø—á–∞:              –í–ö–õ–Æ–ß–ï–ù–ê
–¢–∏–ø:                –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è
–ú–∞–∫—Å. –ø–æ–ø—ã—Ç–æ–∫:      3
Timeout:            15 –º–∏–Ω—É—Ç
–°–æ–æ–±—â–µ–Ω–∏–µ:         üë§ –ü—Ä–∏–≤–µ—Ç! –¢—ã –≤—ã–≥–ª—è–¥–∏—à—å –∫–∞–∫ –±–æ—Ç...
```

## –ü—Ä–∏–º–µ—Ä—ã —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°—Ç—Ä–æ–≥–∞—è –∑–∞—â–∏—Ç–∞
- –¢–∏–ø: **–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è** (–±–æ–ª–µ–µ —Å–ª–æ–∂–Ω–æ –¥–ª—è –±–æ—Ç–æ–≤)
- –ü–æ–ø—ã—Ç–æ–∫: **2** (–∂—ë—Å—Ç–∫–æ)
- Timeout: **10 –º–∏–Ω—É—Ç**

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ö–æ–º—Ñ–æ—Ä—Ç–Ω–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –¢–∏–ø: **–ö–Ω–æ–ø–æ—á–Ω–∞—è** (–ø—Ä–æ—â–µ –¥–ª—è –ª—é–¥–µ–π)
- –ü–æ–ø—ã—Ç–æ–∫: **5** (–±–æ–ª—å—à–µ –ø–æ–ø—ã—Ç–æ–∫)
- Timeout: **30 –º–∏–Ω—É—Ç**

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—Ç–∫–ª—é—á–µ–Ω–∞ –∫–∞–ø—á–∞
- –í–∫–ª—é—á–∏—Ç—å: **–ù–ï–¢**
(–ü–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–ª–∏ –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

## –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –∫–æ–¥–µ

```python
from shop_bot.data_manager.captcha_utils import (
    create_captcha_challenge,
    check_captcha_answer,
    has_passed_captcha,
)

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø—Ä–æ—à–ª–∞ –ª–∏ –∫–∞–ø—á–∞
if not has_passed_captcha(user_id):
    # –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞–ø—á—É...
```

### –§—É–Ω–∫—Ü–∏–∏ API

| –§—É–Ω–∫—Ü–∏—è | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç |
|---------|-----------|
| `create_captcha_challenge()` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞–ø—á—É |
| `check_captcha_answer()` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç |
| `get_active_captcha_challenge()` | –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–∞–ø—á—É |
| `has_passed_captcha()` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ |
| `mark_user_passed_captcha()` | –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–ø—á—É –∫–∞–∫ –ø—Ä–æ–π–¥–µ–Ω–Ω—É—é |

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

**Q: –ì–¥–µ –≤–∏–¥–Ω–æ –∏—Å—Ç–æ—Ä–∏—é –∫–∞–ø—á?**
A: –í —Ç–∞–±–ª–∏—Ü–µ –ë–î `captcha_challenges` (—á–µ—Ä–µ–∑ SQL –∑–∞–ø—Ä–æ—Å—ã)

**Q: –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–∏–º–µ—Ä–æ–≤?**
A: –¢–µ–∫—É—â–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å: –æ–¥–Ω–æ—Ü–∏—Ñ—Ä–æ–≤—ã–µ –∏ –¥–≤—É—Ö—Ü–∏—Ñ—Ä–æ–≤—ã–µ —á–∏—Å–ª–∞ (1-99). –ù—É–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ `captcha_utils.py`

**Q: –ß—Ç–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±—ã–ª –æ—Ç–≤–µ—Ç?**
A: –ö–∞–ø—á–∞ –∏–º–µ–µ—Ç timeout (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 15 –º–∏–Ω—É—Ç). –ü–æ—Å–ª–µ –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å `/start` —Å–Ω–æ–≤–∞.

**Q: –ö–∞–∫ –æ—Ç–∫–ª—é—á–∏—Ç—å –∫–∞–ø—á—É –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞?**
A: –ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –ö–∞–ø—á–∞ ‚Üí –û—Ç–∫–ª—é—á–∏—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å

**Q: –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –∫–∞–ø—á–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ?**
A: –ù–µ—Ç, —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –µ—ë –Ω–µ –≤–∏–¥—è—Ç.

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–ó–∞—â–∏—Ç—ã:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
- –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 15 –º–∏–Ω—É—Ç)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π

‚ö†Ô∏è **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ù–µ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω—ã—Ö –±–æ—Ç–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö —Ä–µ—à–∞—Ç–µ–ª–∏ –∫–∞–ø—á)
- –õ—É—á—à–µ –≤—Å–µ–≥–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –ø–µ—Ä–≤–∞—è –ª–∏–Ω–∏—è –∑–∞—â–∏—Ç—ã

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–¢–∞–±–ª–∏—Ü—ã –ë–î:**
- `captcha_challenges` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–ø—á–∞-–≤—ã–∑–æ–≤–∞—Ö
- `user_captcha_status` - —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –∫–∞–ø—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

**–°–æ—Å—Ç–æ—è–Ω–∏—è FSM:**
- `Captcha.waiting_for_answer` - –æ–∂–∏–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∫–∞–ø—á—É

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
- `captcha_answer_handler` - —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ (–¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏)
- `captcha_button_answer_handler` - –≤—ã–±–æ—Ä –∫–Ω–æ–ø–∫–∏ (–¥–ª—è —Å–º–∞–π–ª–∏–∫–∞)

## –û—Ç–∫–ª—é—á–µ–Ω–∏–µ/–≤–∫–ª—é—á–µ–Ω–∏–µ

### –í—Ä–µ–º–µ–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
1. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å ‚Üí –ö–∞–ø—á–∞
2. –ù–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–û—Ç–∫–ª—é—á–∏—Ç—å"
3. –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –±–µ–∑ –∫–∞–ø—á–∏

### –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ (–≤ –∫–æ–¥–µ)
–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ –≤ `handlers.py`:
```python
if captcha_enabled and not user_exists:
    # –í–µ—Å—å –±–ª–æ–∫ —Å –∫–∞–ø—á–µ–π –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å
```

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

–ö–∞–ø—á–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Å—Ç–∞–¥–∏—é Onboarding –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–î–û**:
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∫–∞–Ω–∞–ª
- –ó–∞–ø—Ä–æ—Å–∞ —Å–æ–≥–ª–∞—Å–∏—è —Å —É—Å–ª–æ–≤–∏—è–º–∏
- –í—ã–¥–∞—á–∏ —Ç—Ä–∏–∞–ª—å–Ω–æ–≥–æ –∫–ª—é—á–∞

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º —Å–º. —Ñ–∞–π–ª `CAPTCHA_IMPLEMENTATION.md` –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

{% extends 'base.html' %}
{% block title %}Поддержка — Панель{% endblock %}

{% block content %}
<div class="page-header d-print-none mb-4">
  <div class="row align-items-center">
    <div class="col">
      <h1 class="page-title mb-1">
        <i class="ti ti-headset me-2"></i>
        Поддержка
      </h1>
      <div class="text-secondary mt-1">Управление обращениями пользователей</div>
    </div>
  </div>
</div>

<!-- Статистика -->
<div class="row mb-4">
  <div class="col-md-4 mb-3">
    <div class="card support-stats-card">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="support-stats-icon bg-blue-lt">
            <i class="ti ti-inbox"></i>
          </div>
          <div class="ms-3">
            <div class="text-secondary small">Всего обращений</div>
            <h3 class="mb-0">{{ all_count }}</h3>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card support-stats-card">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="support-stats-icon bg-green-lt">
            <i class="ti ti-circle-check"></i>
          </div>
          <div class="ms-3">
            <div class="text-secondary small">Открытые</div>
            <h3 class="mb-0 text-success">{{ open_count }}</h3>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-4 mb-3">
    <div class="card support-stats-card">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="support-stats-icon bg-gray-lt">
            <i class="ti ti-circle-x"></i>
          </div>
          <div class="ms-3">
            <div class="text-secondary small">Закрытые</div>
            <h3 class="mb-0">{{ closed_count }}</h3>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Фильтры -->
<div class="card mb-4 support-filters-card">
  <div class="card-body">
    <div class="d-flex align-items-center gap-3 flex-wrap">
      <div class="d-flex align-items-center gap-2">
        <div class="text-secondary">
          <i class="ti ti-filter me-1"></i>
          Фильтр:
        </div>
        <div class="support-btn-group">
          <a class="support-filter-btn {% if not filter_status %}active{% endif %}" href="{{ url_for('support_list_page') }}">
            <i class="ti ti-list me-1"></i>
            Все
          </a>
          <a class="support-filter-btn {% if filter_status == 'open' %}active{% endif %}" href="{{ url_for('support_list_page', status='open') }}">
            <i class="ti ti-circle-check me-1"></i>
            Открытые
          </a>
          <a class="support-filter-btn {% if filter_status == 'closed' %}active{% endif %}" href="{{ url_for('support_list_page', status='closed') }}">
            <i class="ti ti-circle-x me-1"></i>
            Закрытые
          </a>
        </div>
      </div>
      <div class="ms-auto support-search-box">
        <div class="input-group">
          <span class="input-group-text">
            <i class="ti ti-search"></i>
          </span>
          <input type="text" 
                 class="form-control" 
                 id="support-search" 
                 placeholder="Поиск по ID, теме, пользователю..."
                 autocomplete="off">
        </div>
      </div>
    </div>
  </div>
</div>

{% if tickets %}
<!-- Список обращений -->
<div class="support-tickets-grid" id="support-tbody"
     data-fetch-url="{{ url_for('support_table_partial', status=filter_status, page=current_page) }}"
     data-fetch-interval="10000">
  {% include 'partials/support_table.html' %}
</div>

{% if total_pages > 1 %}
<div class="card mt-4">
  <div class="card-body">
    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
      <div class="text-secondary">
        <i class="ti ti-file-text me-1"></i>
        Страница <strong>{{ current_page }}</strong> из <strong>{{ total_pages }}</strong>
      </div>
      <ul class="pagination m-0">
        <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('support_list_page', status=filter_status, page=current_page-1) }}">
            <i class="ti ti-chevron-left me-1"></i>
            Назад
          </a>
        </li>
        <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('support_list_page', status=filter_status, page=current_page+1) }}">
            Вперед
            <i class="ti ti-chevron-right ms-1"></i>
          </a>
        </li>
      </ul>
    </div>
  </div>
</div>
{% endif %}

{% else %}
<div class="card support-empty-state">
  <div class="card-body text-center py-5">
    <div class="support-empty-icon mb-3">
      <i class="ti ti-inbox-off"></i>
    </div>
    <h3 class="mb-2">Обращений пока нет</h3>
    <p class="text-secondary mb-0">
      {% if filter_status == 'open' %}
        Нет открытых обращений в поддержку
      {% elif filter_status == 'closed' %}
        Нет закрытых обращений в поддержку
      {% else %}
        Когда пользователи обратятся в поддержку, их сообщения появятся здесь
      {% endif %}
    </p>
  </div>
</div>
{% endif %}

{% endblock %}

{% extends "base.html" %}
{% block title %}–ú–æ–¥—É–ª–∏{% endblock %}
{% block content %}

<div class="page-header d-print-none mb-4">
  <div class="row align-items-center">
    <div class="col">
      <h1 class="page-title mb-1">–ú–æ–¥—É–ª–∏</h1>
      <div class="text-secondary">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ –±–æ—Ç–∞ –∏ –ø–∞–Ω–µ–ª–∏</div>
    </div>
  </div>
</div>

<!-- Upload Module Card -->
<div class="card mb-4">
  <div class="card-header">
    <h3 class="card-title">üì¶ –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å</h3>
  </div>
  <div class="card-body">
    <form action="{{ url_for('module_upload_route') }}" method="post" enctype="multipart/form-data">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
      <div class="row">
        <div class="col-auto">
          <div class="input-group">
            <input type="file" name="module_file" class="form-control pill" accept=".zip" required />
            <button type="submit" class="btn btn-primary">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
          </div>
          <small class="text-secondary d-block mt-2">
            –û–∂–∏–¥–∞–µ—Ç—Å—è ZIP –∞—Ä—Ö–∏–≤ —Å –º–æ–¥—É–ª–µ–º. –ú–æ–¥—É–ª—å –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø–∞–∫–æ–≤–∞–Ω –∏ –≤–∫–ª—é—á–µ–Ω.
          </small>
        </div>
      </div>
    </form>
  </div>
</div>

<div class="card">
  <div class="card-body">
    {% if modules %}
    <div class="table-responsive">
      <table class="table table-vcenter table-hover">
        <thead>
          <tr>
            <th>–ú–æ–¥—É–ª—å</th>
            <th>–í–µ—Ä—Å–∏—è</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% for m in modules %}
          <tr>
            <td>
              <div class="fw-bold">{{ m.name }}</div>
              <div class="text-secondary small">{{ m.id }}</div>
            </td>
            <td>{{ m.version or "‚Äî" }}</td>
            <td>
              {% if m.status == 'enabled' %}
                <span class="badge bg-green-lt">–í–∫–ª—é—á–µ–Ω</span>
              {% elif m.status == 'error' %}
                <span class="badge bg-red-lt">–û—à–∏–±–∫–∞</span>
              {% else %}
                <span class="badge bg-yellow-lt">–û—Ç–∫–ª—é—á–µ–Ω</span>
              {% endif %}
              {% if m.error_message %}
                <div class="text-danger small mt-1">{{ m.error_message }}</div>
              {% endif %}
            </td>
            <td>{{ m.description or "‚Äî" }}</td>
            <td class="text-end">
              <div class="d-inline-flex gap-2 flex-wrap justify-content-end">
                {% if m.status != 'enabled' %}
                <form action="{{ url_for('module_enable_route', module_id=m.id) }}" method="post">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                  <button type="submit" class="btn btn-success btn-sm">–í–∫–ª—é—á–∏—Ç—å</button>
                </form>
                {% else %}
                <form action="{{ url_for('module_disable_route', module_id=m.id) }}" method="post">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                  <button type="submit" class="btn btn-warning btn-sm">–û—Ç–∫–ª—é—á–∏—Ç—å</button>
                </form>
                {% endif %}

                {% if m.has_settings %}
                <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('module_settings_page', module_id=m.id) }}">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                {% endif %}

                <form action="{{ url_for('module_delete_route', module_id=m.id) }}" method="post" data-confirm="–£–¥–∞–ª–∏—Ç—å –º–æ–¥—É–ª—å –∏ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ?">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
                  <button type="submit" class="btn btn-outline-danger btn-sm">–£–¥–∞–ª–∏—Ç—å</button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="text-secondary">–ú–æ–¥—É–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</div>
    {% endif %}
  </div>
</div>

{% endblock %}
